# SSH - 反向隧道 & 内网穿透

## 0.0 概述

本文用于记录，如何利用个人公网`VPS`搭建`SSH隧道`

## 0.1 事前准备

| 机器代号 |  机器位置   | 地址(域名orIP) | 用户名 | sshd端口 | 是否需要运行sshd |
| :------: | :---------: | :------------: | :----: | :------: | :--------------: |
|    A     |  位于公网   |  192.168.11.2  |  vps   |    22    |       yes        |
|    B     | 位于NAT之后 |   非必须信息   | userb  |    22    |       yes        |
|    C     | 位于NAT之后 |   非必须信息   | userc  |    22    |        no        |

## 1.0 SSH反向隧道

在你的受限的家庭网络之外你需要另一台主机（所谓的“中继主机”），你能从当前所在地通过 SSH 登录到它。你可以用有公网 IP 地址的VPS配置成一个中继主机。然后要做的就是从你的家庭服务器中建立一个到公网中继主机的**永久 SSH 隧道**。有了这个隧道，你就可以从中继主机中连接“回”家庭服务器（这就是为什么称之为 “反向” 隧道）。不管你在哪里、你的家庭网络中的 NAT 或 防火墙限制多么严格，只要你可以访问中继主机，你就可以连接到家庭服务器

反向隧道的建立依赖于SSH的远程端口转发功能，单纯建立家庭服务器和中继主机的SSH连接是不够的，还需要中继主机将访问机器的数据转发通过已经建立的SSH连接转发到家庭服务器才行。远程端口转发即使在建立本地主机和远程主机SSH连接的同时，设置一个转发规则。指定远程主机利用这个SSH连接将指定的远程端口的数据转发到指定的目标主机的目标端口

![](https://img.linux.net.cn/data/attachment/album/201508/07/235248bx5kxx52gg8yyty4.jpg)
